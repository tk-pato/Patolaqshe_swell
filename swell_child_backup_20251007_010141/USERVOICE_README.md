# User's Voice (お客様の声) 機能 - 実装ドキュメント# お客様の声システム実装完了



## 概要## 概要

このドキュメントは、WordPress のカスタム投稿タイプを利用したお客様の声機能の実装について説明します。WordPressの投稿システムと連携したお客様の声セクションを実装しました。

通常のブログ投稿と、お客様の声投稿の2種類の投稿タイプが利用可能になります。

## 機能詳細

## 実装された機能

### 1. カスタム投稿タイプ「uservoice」

- 投稿タイプ名: `uservoice`### 1. カスタム投稿タイプ「testimonial」

- ラベル: 「お客様の声」- 投稿タイプ名: `testimonial`

- 管理画面メニューに表示- 管理画面での表示名: 「お客様の声」

- REST API サポート- メニューアイコン: 星マーク

- アイコン: dashicons-star-filled- サポート機能: タイトル、エディタ、アイキャッチ画像、抜粋



### 2. カスタムフィールド### 2. カスタムフィールド

- **顧客名** (`_customer_name`): お客様の名前- **顧客名** (`_customer_name`): お客様の名前

- **星評価** (`_rating`): 1-5段階の評価- **見出し** (`_testimonial_title`): 推薦文のタイトル

- **顧客画像** (`_customer_image`): お客様の写真（メディアライブラリより選択）- **星評価** (`_rating`): 1〜5の星評価

- **見出し** (`_uservoice_title`): 推薦文のタイトル- **顧客画像** (`_customer_image`): お客様の写真（120x120px推奨）



### 3. フロントエンド表示### 3. 管理画面機能

- Swiperスライダーを使用したレスポンシブ表示- 投稿一覧に顧客名と評価を表示

- PC: 3カラム、タブレット: 2カラム、スマホ: 1カラム- メディアアップローダーによる画像選択

- 自動再生（5秒間隔）- 直感的な星評価選択

- ナビゲーションボタンとページネーション付き- バリデーション機能



## ファイル構成### 4. フロントエンド表示

- Swiperスライダーによる美しい表示

```- レスポンシブ対応（PC: 3件、タブレット: 1件、モバイル: 1件）

swell_child/- 自動再生機能（ホバー時停止）

├── functions.php (カスタム投稿タイプ・メタボックス定義)- ページネーションとナビゲーション矢印

├── front-page.php (フロントページでのtemplate-part呼び出し)

├── css/## ファイル構成

│   └── section-uservoice.css (専用スタイル)

├── template-parts/front/section-uservoice.php (表示テンプレート)```

└── js/uservoice-slider.js (Swiperスライダー設定)swell_child/

```├── functions.php (カスタム投稿タイプとメタボックス)

├── front-page.php (テンプレート呼び出し修正)

## 管理画面での使用方法├── template-parts/front/section-testimonials.php (表示テンプレート)

└── js/testimonials-slider.js (Swiperスライダー設定)

### 1. 新規追加```

1. WordPress管理画面で「お客様の声」→「新規追加」をクリック

2. タイトル、本文を入力## 使用方法

3. 「お客様の声詳細」メタボックスで以下を入力：

   - 顧客名### 管理画面でお客様の声を追加

   - 見出し1. WordPress管理画面で「お客様の声」メニューを選択

   - 星評価（1-5）2. 「新規追加」をクリック

   - 顧客画像（任意）3. 以下の項目を入力：

4. 「公開」をクリック   - **タイトル**: 内部管理用（表示されません）

   - **本文**: お客様のコメント内容

### 2. 一覧表示   - **顧客名**: 表示される名前

管理画面の投稿一覧では、顧客名、評価が追加カラムとして表示されます。   - **見出し**: 推薦文のタイトル（例: "Amazing customer service！"）

   - **星評価**: 1〜5の評価

## データベース構造   - **顧客画像**: お客様の写真（任意）



### テーブル### 投稿の管理

- カスタム投稿タイプ: `wp_posts` テーブル（post_type = 'uservoice'）- 投稿一覧で顧客名と星評価が確認可能

- カスタムフィールド: `wp_postmeta` テーブル- ドラッグ&ドロップで表示順序を変更可能（メニューオーダー）

  - `_customer_name`: 顧客名- 通常のWordPress投稿と同様に編集・削除可能

  - `_rating`: 星評価

  - `_customer_image`: 顧客画像ID## 技術仕様

  - `_uservoice_title`: 見出し

### データベース構造

## カスタマイズ- カスタム投稿タイプ: `wp_posts` テーブル（post_type = 'testimonial'）

- カスタムフィールド: `wp_postmeta` テーブル

### 表示件数の変更  - `_customer_name`: 顧客名

`template-parts/front/section-uservoice.php` の15行目：  - `_testimonial_title`: 見出し

```php  - `_rating`: 星評価（1-5の整数）

'posts_per_page' => 6, // 最大6件表示  - `_customer_image`: 画像のattachment ID

```

### 表示制限

### スライダー設定の変更- フロントページで最大6件まで表示

`js/uservoice-slider.js` でSwiperの設定をカスタマイズ可能：- 投稿日時とメニューオーダーで並び順を制御

- autoplay の delay（自動再生間隔）- 公開ステータスの投稿のみ表示

- breakpoints（レスポンシブ設定）

- slidesPerView（表示数）### パフォーマンス最適化

- Intersection Observer による可視性監視

## 注意事項- 必要なページでのみJavaScript読み込み

- CSS/JSの最適化

1. **依存関係**: 親テーマのSwiper.jsライブラリを利用

2. **画像サイズ**: 顧客画像は120x120pxで表示される## 今後の展開

3. **SEO**: アーカイブページは無効化されている（has_archive: false）

4. **キャッシュ**: CSSとJSにファイル更新時刻をバージョンとして付与### 可能な拡張機能

1. **カテゴリ分類**: サービス別のお客様の声

## トラブルシューティング2. **一覧ページ**: すべてのお客様の声を表示するページ

3. **検索機能**: 評価やサービス別での絞り込み

### スライダーが動作しない場合4. **ソーシャル連携**: SNSでの共有機能

1. Swiper.jsが正しく読み込まれているか確認5. **承認システム**: 投稿前の管理者承認機能

2. コンソールエラーをチェック

3. CSS セレクタが正しいか確認### 互換性

- SWELLテーマとの完全互換

### カスタムフィールドが保存されない場合- 既存のブロックエディタとの共存

1. nonceフィールドが正しく設定されているか確認- 他のプラグインとの競合回避

2. ユーザー権限を確認

3. functions.phpでエラーが発生していないか確認## 注意事項

1. **既存のvoicesブロック**: 既存の静的なお客様の声ブロックは表示されなくなります
2. **画像サイズ**: 顧客画像は120x120pxに最適化されます
3. **Swiper依存**: SwiperライブラリがSWELLテーマに含まれている前提です

---

**実装完了**: WordPressの投稿システムと完全に連携したお客様の声セクションが利用可能になりました。