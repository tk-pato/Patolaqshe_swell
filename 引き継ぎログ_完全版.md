# Patolaqshe SWELL 子テーマ開発 - 完全引き継ぎログ
**更新日: 2025年10月1日**  
**状態: INTRO セクション実装完了、本番環境デプロイ済み**

---

## 📋 プロジェクト概要

### サイト情報
- **サイト名**: Patolaqshe
- **CMS**: WordPress 6+ / PHP 8+
- **テーマ**: SWELL（親テーマ）+ swell_child（子テーマ）
- **開発環境**: macOS + VS Code
- **本番環境**: さくらサーバー (www3521.sakura.ne.jp)

### ディレクトリ構造
```
/Users/tk/Desktop/Patolaqshe_swell/
├── swell_child/                    # メイン開発ディレクトリ
│   ├── style.css                   # メインスタイルシート
│   ├── functions.php               # テーマ機能拡張
│   ├── front-page.php              # フロントページテンプレート
│   ├── css/                        # セクション別CSS
│   │   ├── section-salon.css
│   │   └── section-intro.css       # 新規作成完了
│   ├── template-parts/front/       # テンプレート部品
│   │   ├── section-salon.php
│   │   └── section-intro.php       # 新規作成完了
│   └── img/                        # 画像素材
├── BACKUPS/                        # バックアップディレクトリ
└── BK/                            # 旧ファイル保管
```

---

## 🚀 デプロイ・アップロード方法（不変ルール）

### 本番サーバー情報
- **サーバー**: patolaqshe@www3521.sakura.ne.jp
- **パス**: `/home/patolaqshe/www/media/wp-content/themes/swell_child/`
- **接続方法**: SSH/SCP

### 標準アップロードコマンド

#### 1. 個別ファイルアップロード（SCP）
```bash
# メインファイル
scp swell_child/style.css patolaqshe@www3521.sakura.ne.jp:/home/patolaqshe/www/media/wp-content/themes/swell_child/
scp swell_child/functions.php patolaqshe@www3521.sakura.ne.jp:/home/patolaqshe/www/media/wp-content/themes/swell_child/
scp swell_child/front-page.php patolaqshe@www3521.sakura.ne.jp:/home/patolaqshe/www/media/wp-content/themes/swell_child/

# CSS ファイル
scp swell_child/css/section-salon.css patolaqshe@www3521.sakura.ne.jp:/home/patolaqshe/www/media/wp-content/themes/swell_child/css/
scp swell_child/css/section-intro.css patolaqshe@www3521.sakura.ne.jp:/home/patolaqshe/www/media/wp-content/themes/swell_child/css/

# テンプレートファイル
scp swell_child/template-parts/front/section-salon.php patolaqshe@www3521.sakura.ne.jp:/home/patolaqshe/www/media/wp-content/themes/swell_child/template-parts/front/
scp swell_child/template-parts/front/section-intro.php patolaqshe@www3521.sakura.ne.jp:/home/patolaqshe/www/media/wp-content/themes/swell_child/template-parts/front/

# 画像ファイル
scp swell_child/img/*.png patolaqshe@www3521.sakura.ne.jp:/home/patolaqshe/www/media/wp-content/themes/swell_child/img/
```

#### 2. 一括アップロード（rsync）
```bash
# SALON セクション専用
rsync -avz --progress swell_child/css/section-salon.css swell_child/template-parts/front/section-salon.php patolaqshe@www3521.sakura.ne.jp:/home/patolaqshe/www/media/wp-content/themes/swell_child/

# 全体同期（注意して使用）
rsync -avz --progress swell_child/ patolaqshe@www3521.sakura.ne.jp:/home/patolaqshe/www/media/wp-content/themes/swell_child/ --exclude="*.bak" --exclude="*.backup"
```

#### 3. 自動化スクリプト
- **`upload-salon-files.sh`**: SALON セクション関連ファイル一括アップロード
- **`deploy_css_rsync.sh`**: CSS ファイル専用アップロード

---

## 📊 実装済み機能

### 1. SALON セクション（完了）
**ファイル**: `swell_child/template-parts/front/section-salon.php`  
**CSS**: `swell_child/css/section-salon.css`  
**状態**: 本番環境動作確認済み

#### 主要機能
- コンテナ幅調整システム（100vw フルブリード対応）
- レスポンシブデザイン完全対応
- WordPress カスタマイザー連携（20設定）
- 背景画像・動画対応

#### WordPress カスタマイザー設定
```php
// functions.php で登録済み
'salon_title' => 'サロンについて',
'salon_subtitle' => 'ABOUT SALON',
'salon_description' => '説明文...',
'salon_background_type' => 'image',
'salon_background_image' => '',
'salon_background_video' => '',
// ... 全20設定
```

### 2. INTRO セクション（完了）
**ファイル**: `swell_child/template-parts/front/section-intro.php`  
**CSS**: `swell_child/css/section-intro.css`  
**状態**: 2025年10月1日実装完了・デプロイ済み

#### 主要機能
- 完全レスポンシブデザイン
- 背景画像対応（フォールバック機能付き）
- WordPress カスタマイザー完全連携（17設定）
- CSS Grid レイアウト
- デフォルト背景画像対応

#### WordPress カスタマイザー設定（17項目）
```php
// functions.php で登録済み
'intro_title' => 'イントロダクション',
'intro_subtitle' => 'INTRODUCTION',
'intro_description' => '私たちについて...',
'intro_background_image' => '',
'intro_text_color' => '#333333',
'intro_background_color' => '#ffffff',
'intro_padding_top' => '80',
'intro_padding_bottom' => '80',
'intro_content_max_width' => '800',
'intro_title_font_size' => '32',
'intro_subtitle_font_size' => '16',
'intro_description_font_size' => '16',
'intro_title_margin_bottom' => '20',
'intro_subtitle_margin_bottom' => '30',
'intro_description_line_height' => '1.8',
'intro_border_radius' => '0',
'intro_box_shadow' => '0 4px 12px rgba(0,0,0,0.1)'
```

#### front-page.php 統合
```php
// NEWS セクション後に追加済み
<?php get_template_part('template-parts/front/section-intro'); ?>
```

---

## 🔧 技術仕様

### CSS アーキテクチャ
1. **style.css**: メインスタイルシート（全体レイアウト・共通設定）
2. **section-*.css**: セクション別モジュラーCSS
3. **レスポンシブ対応**: clamp() 関数使用で流動的サイズ調整

### WordPress 統合
- **カスタマイザーAPI**: `customize_register` フック使用
- **テンプレート階層**: `get_template_part()` でモジュール化
- **CSS エンキュー**: `wp_enqueue_style()` で適切な読み込み順序
- **セキュリティ**: `esc_html()`, `esc_url()` で出力エスケープ

### ファイル命名規則
- **PHP テンプレート**: `section-{name}.php`
- **CSS ファイル**: `section-{name}.css`
- **バックアップ**: `{filename}.{extension}.{YYYYMMDD}_{HHMMSS}.backup`

---

## 🎯 現在の状態

### 完成済みセクション
1. ✅ **HERO** - SWELL 標準機能使用
2. ✅ **NEWS** - カスタムスタイル適用済み
3. ✅ **INTRO** - 完全実装完了（2025/10/01）
4. ✅ **SALON** - 完全実装完了
5. ✅ **NAVIGATION**（8ボタン） - 実装済み
6. ✅ **SERVICES** - 実装済み
7. ✅ **USERVOICE** - 実装済み
8. ✅ **BUST-ISSUES** - パララックス対応完了
9. ✅ **REASONS** - 実装済み

### セクション順序（front-page.php）
```php
1. HERO（SWELL標準）
2. NEWS
3. INTRO ← 新規追加完了
4. SALON
5. NAVIGATION
6. SERVICES  
7. USERVOICE
8. BUST-ISSUES
9. REASONS
```

---

## 🚨 重要な修正履歴

### 2025年10月1日 - INTRO セクション実装完了
1. **CSS ファイル破損修正**: `section-intro.css` の重複内容削除・再作成
2. **背景画像フォールバック実装**: デフォルト背景・グラデーション対応
3. **PHP テンプレート改良**: エラーハンドリング・デフォルト値設定
4. **本番環境デプロイ**: 全ファイル正常アップロード確認済み

### 過去の主要修正
- **SALON セクション**: コンテナ幅問題解決（100vw フルブリード対応）
- **レスポンシブ対応**: 全セクション統一的な画面サイズ対応
- **パフォーマンス最適化**: CSS ファイル分割・適切な読み込み順序

---

## 📱 レスポンシブ対応

### ブレイクポイント
- **Mobile**: ~767px
- **Tablet**: 768px~959px  
- **Desktop**: 960px~

### 統一CSS変数
```css
:root {
    --ptl-container-max: 1200px;
    --ptl-container-pad: 20px;
    --ptl-heading-size: clamp(22px, 2.8vw, 28px);
    --ptl-subtitle-size: clamp(16px, 2vw, 18px);
    --section-padding: 80px 0;
}
```

---

## 🔍 デバッグ・トラブルシューティング

### よくある問題
1. **セクションが表示されない** → `front-page.php` の `get_template_part()` 確認
2. **CSS が反映されない** → `functions.php` の `wp_enqueue_style()` 確認  
3. **背景画像が表示されない** → カスタマイザー設定・ファイルパス確認
4. **レスポンシブが崩れる** → CSS の clamp() 関数・メディアクエリ確認

### ファイル確認コマンド
```bash
# ファイルサイズ確認
ls -la swell_child/css/section-intro.css
ls -la swell_child/template-parts/front/section-intro.php

# 本番環境ファイル確認
ssh patolaqshe@www3521.sakura.ne.jp "ls -la /home/patolaqshe/www/media/wp-content/themes/swell_child/css/"
```

---

## 📋 次回作業時の確認事項

### 1. 必須チェック
- [ ] 本番サイトでの INTRO セクション表示確認
- [ ] カスタマイザーでの設定変更テスト
- [ ] 全画面サイズでのレスポンシブ確認
- [ ] 背景画像アップロード・表示テスト

### 2. 改善検討項目
- [ ] アニメーション効果の追加
- [ ] パフォーマンス最適化
- [ ] アクセシビリティ向上
- [ ] SEO 最適化

### 3. バックアップ確認
- [ ] 最新のバックアップファイル存在確認
- [ ] functions.php のバックアップ最新化
- [ ] データベースバックアップ（WordPress管理画面）

---

## 💡 開発メモ

### functions.php 重要な追加内容
```php
// INTRO セクション CSS 読み込み
add_action('wp_enqueue_scripts', 'enqueue_intro_section_styles');
function enqueue_intro_section_styles() {
    if (is_front_page()) {
        wp_enqueue_style(
            'intro-section-style',
            get_stylesheet_directory_uri() . '/css/section-intro.css',
            array(),
            '1.0.3'
        );
    }
}

// INTRO カスタマイザー設定（17項目）
function customize_intro_section($wp_customize) {
    // ... 実装済み
}
add_action('customize_register', 'customize_intro_section');

// INTRO ショートコード
function intro_section_shortcode($atts) {
    // ... 実装済み
}
add_shortcode('intro_section', 'intro_section_shortcode');
```

### CSS 設計方針
- **モジュラー設計**: セクション毎に独立したCSSファイル
- **BEM準拠**: `.ptl-intro__element` 命名規則
- **レスポンシブファースト**: Mobile First + clamp() 関数
- **パフォーマンス重視**: 必要最小限のセレクタ使用

---

## 📞 緊急連絡先・重要情報

### サーバー管理
- **さくらサーバー管理画面**: https://secure.sakura.ad.jp/
- **FTP情報**: patolaqshe@www3521.sakura.ne.jp

### WordPress 管理
- **管理画面**: https://www.patolaqshe.com/wp-admin/
- **カスタマイザー**: 外観 > カスタマイズ

### 開発環境
- **ローカル開発**: `/Users/tk/Desktop/Patolaqshe_swell/`
- **エディタ**: VS Code + GitHub Copilot
- **バージョン管理**: Git（ローカル）

---

**⚠️ 重要: このログは必ず最新状態に保ち、作業前後で更新すること**  
**💾 バックアップ: 重要な変更前は必ずバックアップを作成すること**

---

*最終更新: 2025年10月1日 - INTRO セクション実装完了*